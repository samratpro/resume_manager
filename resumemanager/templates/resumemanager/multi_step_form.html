{% extends 'resumemanager/base.html' %}

{% block extra_css %}
<style>
    .form-section {
        display: none;
    }
    .form-section.active {
        display: block;
        animation: fadeIn 0.3s;
    }
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }
    .nav-buttons {
        display: flex;
        justify-content: space-between;
        margin-top: 2rem;
        gap: 1rem;
    }
    .experience-item {
        background: #f8fafc;
        padding: 1rem;
        border-radius: 8px;
        margin-bottom: 1rem;
        border: 1px solid #e2e8f0;
    }
    .remove-btn {
        background: #ef4444;
        color: white;
        padding: 0.5rem 1rem;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 0.875rem;
    }
    .add-btn {
        background: #10b981;
        color: white;
        padding: 0.75rem 1.5rem;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        margin-top: 1rem;
    }
    #audioRecorder {
        text-align: center;
        padding: 2rem;
        background: #f8fafc;
        border-radius: 8px;
        margin: 1rem 0;
    }
    .record-btn {
        background: #ef4444;
        color: white;
        padding: 1rem 2rem;
        border: none;
        border-radius: 50px;
        cursor: pointer;
        font-size: 1rem;
        font-weight: 600;
        margin: 1rem;
    }
    .record-btn.recording {
        background: #dc2626;
        animation: pulse 1.5s infinite;
    }
    @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.7; }
    }
    .final-checklist {
        background: #f0fdf4;
        border: 2px solid #86efac;
        border-radius: 12px;
        padding: 1.5rem;
        margin: 1.5rem 0;
    }
    .checklist-item {
        display: flex;
        align-items: start;
        margin-bottom: 0.75rem;
        color: #15803d;
    }
    .language-details-block {
        background: #f8fafc;
        padding: 1.5rem;
        border-radius: 8px;
        margin-bottom: 1.5rem;
        border: 1px solid #e2e8f0;
        animation: fadeIn 0.3s;
    }
    .language-details-block h4 {
        color: #2563eb;
        margin-bottom: 1rem;
        font-size: 1.125rem;
        font-weight: 600;
    }
    .language-detail-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-bottom: 1rem;
    }

    .internet-speed-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
    }

    /* Mobile Responsive Styles */
    @media (max-width: 640px) {
        .nav-buttons {
            flex-direction: column;
            gap: 0.75rem;
        }

        .nav-buttons .btn {
            width: 100%;
        }

        .experience-item {
            padding: 0.75rem;
        }

        .language-detail-row {
            grid-template-columns: 1fr;
            gap: 0.75rem;
        }

        .internet-speed-grid {
            grid-template-columns: 1fr;
            gap: 0.75rem;
        }

        #audioRecorder {
            padding: 1rem;
        }

        .record-btn {
            width: 100%;
            padding: 0.875rem 1.5rem;
            font-size: 0.875rem;
        }

        .final-checklist {
            padding: 1rem;
        }

        .checklist-item {
            font-size: 0.875rem;
        }

        .language-details-block {
            padding: 1rem;
        }

        .language-details-block h4 {
            font-size: 1rem;
        }

        .add-btn,
        .remove-btn {
            width: 100%;
        }
    }

    @media (min-width: 641px) and (max-width: 1024px) {
        .language-detail-row {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    /* Touch-friendly interactions */
    @media (hover: none) and (pointer: coarse) {
        .record-btn,
        .add-btn,
        .remove-btn {
            min-height: 44px;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="progress-bar">
    <div class="progress-bar-fill" id="progressBar" style="width: 7.69%;"></div>
</div>

<form method="post" enctype="multipart/form-data" id="multiStepForm">
    {% csrf_token %}

    <!-- Section 1: Informations g√©n√©rales -->
    <div class="form-section active" data-section="1">
        <div class="section-header">
            <div class="section-number">Section 1 / 13</div>
            <h2 class="section-title">Informations g√©n√©rales</h2>
        </div>

        <div class="form-group">
            <label for="last_name" class="form-label required">Nom de famille</label>
            <input type="text" id="last_name" name="last_name" class="form-input" placeholder="Votre nom" required>
        </div>

        <div class="form-group">
            <label for="first_name" class="form-label required">Pr√©nom</label>
            <input type="text" id="first_name" name="first_name" class="form-input" placeholder="Votre pr√©nom" required>
        </div>

        <div class="form-group">
            <label for="date_of_birth" class="form-label required">Date de naissance</label>
            <input type="date" id="date_of_birth" name="date_of_birth" class="form-input" required>
            <small id="dob_error" style="color: #ef4444; font-size: 0.875rem; display: none; margin-top: 0.25rem;">Vous devez avoir au moins 18 ans pour postuler.</small>
        </div>

        <div class="form-group">
            <label for="country" class="form-label required">Pays de r√©sidence</label>
            <select id="country" name="country" class="form-select" required>
                <option value="">S√©lectionnez une option</option>
                <option value="Tunisie">Tunisie</option>
                <option value="France">France</option>
                <option value="Maroc">Maroc</option>
                <option value="Alg√©rie">Alg√©rie</option>
                <option value="Autre">Autre</option>
            </select>
        </div>

        <div class="form-group" id="other_country_group" style="display: none;">
            <label for="other_country" class="form-label required">Pr√©cisez le pays</label>
            <input type="text" id="other_country" name="other_country" class="form-input" placeholder="Nom du pays">
        </div>

        <div class="form-group">
            <label for="city" class="form-label required">Ville de r√©sidence</label>
            <input type="text" id="city" name="city" class="form-input" placeholder="Votre ville" required>
        </div>

        <div class="form-group">
            <label for="phone" class="form-label required">Num√©ro de t√©l√©phone principal (WhatsApp si possible)</label>
            <input type="tel" id="phone" name="phone" class="form-input" placeholder="+216 XX XXX XXX" required>
            <small id="phone_error" style="color: #ef4444; font-size: 0.875rem; display: none; margin-top: 0.25rem;">Veuillez entrer un num√©ro de t√©l√©phone valide.</small>
        </div>

        <div class="form-group">
            <label for="email" class="form-label required">Adresse e-mail</label>
            <input type="email" id="email" name="email" class="form-input" placeholder="votre@email.com" required>
            <small id="email_error" style="color: #ef4444; font-size: 0.875rem; display: none; margin-top: 0.25rem;">Veuillez entrer une adresse e-mail valide.</small>
        </div>

        <div class="form-group">
            <label for="cv" class="form-label">CV (optionnel)</label>
            <input type="file" id="cv" name="cv" class="form-input" accept=".pdf,.doc,.docx">
            <small style="color: #64748b; font-size: 0.875rem;">Formats accept√©s : .pdf,.doc,.docx</small>
        </div>

        <div class="form-group">
            <label for="linkedin" class="form-label">Lien LinkedIn (optionnel)</label>
            <input type="url" id="linkedin" name="linkedin" class="form-input" placeholder="https://linkedin.com/in/votre-profil">
        </div>

        <div class="nav-buttons">
            <div></div>
            <button type="button" class="btn btn-primary" onclick="nextSection()">Suivant ‚Üí</button>
        </div>
    </div>

    <!-- Section 2: Profil & Disponibilit√©s -->
    <div class="form-section" data-section="2">
        <div class="section-header">
            <div class="section-number">Section 2 / 13</div>
            <h2 class="section-title">Profil & Disponibilit√©s</h2>
        </div>

        <div class="form-group">
            <label class="form-label required">Situation actuelle</label>
            <div class="radio-group">
                <div class="radio-item">
                    <input type="radio" id="situation1" name="current_situation" value="En poste" required>
                    <label for="situation1">En poste</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="situation2" name="current_situation" value="En recherche d'emploi">
                    <label for="situation2">En recherche d'emploi</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="situation3" name="current_situation" value="√âtudiant(e)">
                    <label for="situation3">√âtudiant(e)</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="situation4" name="current_situation" value="Freelance / Ind√©pendant">
                    <label for="situation4">Freelance / Ind√©pendant</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="situation5" name="current_situation" value="Autre">
                    <label for="situation5">Autre (pr√©ciser)</label>
                </div>
            </div>
        </div>

        <div class="form-group" id="other_situation_group" style="display: none;">
            <label for="other_situation" class="form-label required">Pr√©cisez votre situation</label>
            <input type="text" id="other_situation" name="other_situation" class="form-input" placeholder="D√©crivez votre situation actuelle">
        </div>

        <div class="form-group">
            <label class="form-label required">Type de contrat recherch√© (plusieurs r√©ponses possibles)</label>
            <div class="checkbox-group">
                <div class="checkbox-item">
                    <input type="checkbox" id="contract1" name="contract_types" value="CDI">
                    <label for="contract1">CDI</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="contract2" name="contract_types" value="CDD">
                    <label for="contract2">CDD</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="contract3" name="contract_types" value="Freelance / Ind√©pendant">
                    <label for="contract3">Freelance / Ind√©pendant</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="contract4" name="contract_types" value="Temps plein">
                    <label for="contract4">Temps plein</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="contract5" name="contract_types" value="Temps partiel">
                    <label for="contract5">Temps partiel</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="contract6" name="contract_types" value="Mission ponctuelle">
                    <label for="contract6">Mission ponctuelle</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="contract7" name="contract_types" value="Stage / Alternance">
                    <label for="contract7">Stage / Alternance</label>
                </div>
            </div>
        </div>

        <div class="form-group">
            <label class="form-label required">Disponibilit√© pour d√©marrer</label>
            <div class="radio-group">
                <div class="radio-item">
                    <input type="radio" id="avail1" name="availability" value="Imm√©diate" required>
                    <label for="avail1">Imm√©diate</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="avail2" name="availability" value="Sous 1 semaine">
                    <label for="avail2">Sous 1 semaine</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="avail3" name="availability" value="Sous 2 semaines">
                    <label for="avail3">Sous 2 semaines</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="avail4" name="availability" value="Sous 1 mois">
                    <label for="avail4">Sous 1 mois</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="avail5" name="availability" value="Plus tard">
                    <label for="avail5">Plus tard (pr√©ciser)</label>
                </div>
            </div>
        </div>

        <div class="form-group" id="availability_details_group" style="display: none;">
            <label for="availability_details" class="form-label">Pr√©cisez votre date ou d√©lai estim√©</label>
            <input type="text" id="availability_details" name="availability_details" class="form-input" placeholder="Ex: Disponible √† partir du 15 janvier">
        </div>

        <div class="form-group">
            <label class="form-label required">√ätes-vous flexible pour un temps plein ?</label>
            <div class="radio-group">
                <div class="radio-item">
                    <input type="radio" id="flex1" name="full_time_flexibility" value="Oui, totalement flexible pour un temps plein" required>
                    <label for="flex1">Oui, totalement flexible pour un temps plein</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="flex2" name="full_time_flexibility" value="Oui, mais sous conditions">
                    <label for="flex2">Oui, mais sous conditions (pr√©ciser)</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="flex3" name="full_time_flexibility" value="Non, je pr√©f√®re rester en temps partiel">
                    <label for="flex3">Non, je pr√©f√®re rester en temps partiel</label>
                </div>
            </div>
        </div>

        <div class="form-group" id="flexibility_conditions_group" style="display: none;">
            <label for="full_time_conditions" class="form-label">Pr√©cisez vos contraintes</label>
            <textarea id="full_time_conditions" name="full_time_conditions" class="form-textarea" placeholder="D√©crivez vos contraintes..."></textarea>
        </div>

        <div class="form-group">
            <label class="form-label required">Volume horaire souhait√© par semaine</label>
            <div class="radio-group">
                <div class="radio-item">
                    <input type="radio" id="hours1" name="weekly_hours" value="Moins de 20 h" required>
                    <label for="hours1">Moins de 20 h</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="hours2" name="weekly_hours" value="20‚Äì30h">
                    <label for="hours2">20‚Äì30h</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="hours3" name="weekly_hours" value="30‚Äì35h">
                    <label for="hours3">30‚Äì35h</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="hours4" name="weekly_hours" value="35‚Äì40h">
                    <label for="hours4">35‚Äì40h</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="hours5" name="weekly_hours" value="Plus de 40h">
                    <label for="hours5">Plus de 40h</label>
                </div>
            </div>
        </div>

        <div class="form-group">
            <label class="form-label required">Disponibilit√©s par tranches horaires (plusieurs r√©ponses possibles)</label>
            <div class="checkbox-group">
                <div class="checkbox-item">
                    <input type="checkbox" id="time1" name="time_slots" value="06h‚Äì09h">
                    <label for="time1">06h‚Äì09h</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="time2" name="time_slots" value="09h‚Äì12h">
                    <label for="time2">09h‚Äì12h</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="time3" name="time_slots" value="12h‚Äì15h">
                    <label for="time3">12h‚Äì15h</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="time4" name="time_slots" value="15h‚Äì18h">
                    <label for="time4">15h‚Äì18h</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="time5" name="time_slots" value="18h‚Äì21h">
                    <label for="time5">18h‚Äì21h</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="time6" name="time_slots" value="21h‚Äì00h">
                    <label for="time6">21h‚Äì00h</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="time7" name="time_slots" value="00h‚Äì06h">
                    <label for="time7">00h‚Äì06h</label>
                </div>
            </div>
        </div>

        <div class="form-group">
            <label class="form-label required">Disponibilit√©s par jour de la semaine (plusieurs r√©ponses possibles)</label>
            <div class="checkbox-group">
                <div class="checkbox-item">
                    <input type="checkbox" id="day1" name="week_days" value="Lundi">
                    <label for="day1">Lundi</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="day2" name="week_days" value="Mardi">
                    <label for="day2">Mardi</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="day3" name="week_days" value="Mercredi">
                    <label for="day3">Mercredi</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="day4" name="week_days" value="Jeudi">
                    <label for="day4">Jeudi</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="day5" name="week_days" value="Vendredi">
                    <label for="day5">Vendredi</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="day6" name="week_days" value="Samedi">
                    <label for="day6">Samedi</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="day7" name="week_days" value="Dimanche">
                    <label for="day7">Dimanche</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="day8" name="week_days" value="Variable selon planning">
                    <label for="day8">Variable selon planning (pr√©ciser)</label>
                </div>
            </div>
        </div>

        <div class="form-group">
            <label class="form-label required">Pr√©f√©rence de mode de travail</label>
            <div class="radio-group">
                <div class="radio-item">
                    <input type="radio" id="work1" name="work_mode" value="T√©l√©travail 100 %" required>
                    <label for="work1">T√©l√©travail 100 %</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="work2" name="work_mode" value="Hybride">
                    <label for="work2">Hybride (mix bureau & t√©l√©travail)</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="work3" name="work_mode" value="Pr√©sentiel uniquement">
                    <label for="work3">Pr√©sentiel uniquement</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="work4" name="work_mode" value="Peu importe">
                    <label for="work4">Peu importe</label>
                </div>
            </div>
        </div>

        <div class="form-group">
            <label for="personal_constraints" class="form-label">Contrainte personnelle importante √† signaler ? (optionnel)</label>
            <textarea id="personal_constraints" name="personal_constraints" class="form-textarea" placeholder="Ex: autre emploi, √©tudes, garde d'enfants, d√©placements..."></textarea>
        </div>

        <div class="nav-buttons">
            <button type="button" class="btn btn-secondary" onclick="prevSection()">‚Üê Pr√©c√©dent</button>
            <button type="button" class="btn btn-primary" onclick="nextSection()">Suivant ‚Üí</button>
        </div>
    </div>

    <!-- Section 3: Langues -->
    <div class="form-section" data-section="3">
        <div class="section-header">
            <div class="section-number">Section 3 / 13</div>
            <h2 class="section-title">Langues</h2>
        </div>

        <div class="form-group">
            <label class="form-label required">Langues ma√Ætris√©es (niveau professionnel ou courant)</label>
            <p style="color: #64748b; font-size: 0.875rem; margin-bottom: 1rem;">
                S√©lectionnez les langues que vous ma√Ætrisez. Pour chaque langue s√©lectionn√©e, vous devrez pr√©ciser votre niveau de comp√©tence.
            </p>
            <div class="checkbox-group" id="languagesCheckboxGroup">
                <div class="checkbox-item">
                    <input type="checkbox" id="lang1" name="languages" value="Fran√ßais" onchange="toggleLanguageDetails('Fran√ßais', this.checked)">
                    <label for="lang1">Fran√ßais</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="lang2" name="languages" value="Anglais" onchange="toggleLanguageDetails('Anglais', this.checked)">
                    <label for="lang2">Anglais</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="lang3" name="languages" value="Allemand" onchange="toggleLanguageDetails('Allemand', this.checked)">
                    <label for="lang3">Allemand</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="lang4" name="languages" value="Espagnol" onchange="toggleLanguageDetails('Espagnol', this.checked)">
                    <label for="lang4">Espagnol</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="lang5" name="languages" value="Italien" onchange="toggleLanguageDetails('Italien', this.checked)">
                    <label for="lang5">Italien</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="lang6" name="languages" value="Portugais" onchange="toggleLanguageDetails('Portugais', this.checked)">
                    <label for="lang6">Portugais</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="lang7" name="languages" value="N√©erlandais" onchange="toggleLanguageDetails('N√©erlandais', this.checked)">
                    <label for="lang7">N√©erlandais</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="lang8" name="languages" value="Arabe" onchange="toggleLanguageDetails('Arabe', this.checked)">
                    <label for="lang8">Arabe</label>
                </div>
            </div>
        </div>

        <!-- Dynamic Language Details Container -->
        <div id="languageDetailsContainer"></div>

        <div class="nav-buttons">
            <button type="button" class="btn btn-secondary" onclick="prevSection()">‚Üê Pr√©c√©dent</button>
            <button type="button" class="btn btn-primary" onclick="nextSection()">Suivant ‚Üí</button>
        </div>
    </div>

    <!-- Section 4: Poste(s) Vis√©(s) -->
    <div class="form-section" data-section="4">
        <div class="section-header">
            <div class="section-number">Section 4 / 13</div>
            <h2 class="section-title">Poste(s) Vis√©(s)</h2>
        </div>

        <div class="form-group">
            <label class="form-label required">Poste(s) que vous visez chez nous ? (plusieurs r√©ponses possibles)</label>
            <div class="checkbox-group">
                <div class="checkbox-item">
                    <input type="checkbox" id="pos1" name="target_positions" value="Agent call center / Service client">
                    <label for="pos1">Agent call center / Service client</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="pos2" name="target_positions" value="T√©l√©vendeur / Commercial t√©l√©phonique / Closer">
                    <label for="pos2">T√©l√©vendeur / Commercial t√©l√©phonique / Closer</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="pos3" name="target_positions" value="Prise de rendez-vous">
                    <label for="pos3">Prise de rendez-vous</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="pos4" name="target_positions" value="Superviseur / Team Leader">
                    <label for="pos4">Superviseur / Team Leader</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="pos5" name="target_positions" value="Formateur / Coach">
                    <label for="pos5">Formateur / Coach</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="pos6" name="target_positions" value="Qualit√© (√©coute & scoring d'appels)">
                    <label for="pos6">Qualit√© (√©coute & scoring d'appels)</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="pos7" name="target_positions" value="Back-office / Support administratif">
                    <label for="pos7">Back-office / Support administratif</label>
                </div>
            </div>
        </div>

        <div class="form-group">
            <label for="priority_position" class="form-label required">Poste souhait√© en priorit√©</label>
            <select id="priority_position" name="priority_position" class="form-select" required>
                <option value="">S√©lectionnez une option</option>
                <option value="Agent call center / Service client">Agent call center / Service client</option>
                <option value="T√©l√©vendeur / Commercial t√©l√©phonique / Closer">T√©l√©vendeur / Commercial t√©l√©phonique / Closer</option>
                <option value="Prise de rendez-vous">Prise de rendez-vous</option>
                <option value="Superviseur / Team Leader">Superviseur / Team Leader</option>
                <option value="Formateur / Coach">Formateur / Coach</option>
                <option value="Qualit√© (√©coute & scoring d'appels)">Qualit√© (√©coute & scoring d'appels)</option>
                <option value="Back-office / Support administratif">Back-office / Support administratif</option>
            </select>
        </div>

        <div class="nav-buttons">
            <button type="button" class="btn btn-secondary" onclick="prevSection()">‚Üê Pr√©c√©dent</button>
            <button type="button" class="btn btn-primary" onclick="nextSection()">Suivant ‚Üí</button>
        </div>
    </div>

    <!-- Section 5: Exp√©rience en Call Center -->
    <div class="form-section" data-section="5">
        <div class="section-header">
            <div class="section-number">Section 5 / 13</div>
            <h2 class="section-title">Exp√©rience en centre d‚Äôappels / Vente</h2>
        </div>

        <div class="form-group">
            <label class="form-label required">Avez-vous d√©j√† travaill√© en call center ou en t√©l√©vente ?</label>
            <div class="radio-group">
                <div class="radio-item">
                    <input type="radio" id="exp1" name="has_call_center_experience" value="Oui" required>
                    <label for="exp1">Oui</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="exp2" name="has_call_center_experience" value="Non">
                    <label for="exp2">Non</label>
                </div>
            </div>
        </div>

        <div class="nav-buttons">
            <button type="button" class="btn btn-secondary" onclick="prevSection()">‚Üê Pr√©c√©dent</button>
            <button type="button" class="btn btn-primary" onclick="nextSection()">Suivant ‚Üí</button>
        </div>
    </div>

    <!-- Section 6: Exp√©riences D√©taill√©es -->
    <div class="form-section" data-section="6">
        <div class="section-header">
            <div class="section-number">Section 6 / 13</div>
            <h2 class="section-title">Exp√©riences D√©taill√©es</h2>
        </div>

        <div class="form-group">
            <label class="form-label">D√©crivez vos exp√©riences professionnelles en d√©tail (surtout celles li√©es au call center)</label>
            <div id="experiencesContainer"></div>
            <button type="button" class="add-btn" onclick="addExperience()">‚ûï Ajouter une exp√©rience</button>
        </div>

        <div class="nav-buttons">
            <button type="button" class="btn btn-secondary" onclick="prevSection()">‚Üê Pr√©c√©dent</button>
            <button type="button" class="btn btn-primary" onclick="nextSection()">Suivant ‚Üí</button>
        </div>
    </div>

    <!-- Section 7: Performance & KPIs -->
    <div class="form-section" data-section="7">
        <div class="section-header">
            <div class="section-number">Section 7 / 13</div>
            <h2 class="section-title">Performance & KPIs</h2>
        </div>

        <div class="form-group">
            <label class="form-label required">Avez-vous d√©j√† travaill√© avec des objectifs et des KPIs chiffr√©s ?</label>
            <div class="radio-group">
                <div class="radio-item">
                    <input type="radio" id="kpi1" name="worked_with_kpis" value="Oui, tout le temps" required>
                    <label for="kpi1">Oui, tout le temps</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="kpi2" name="worked_with_kpis" value="Oui, parfois">
                    <label for="kpi2">Oui, parfois</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="kpi3" name="worked_with_kpis" value="Non">
                    <label for="kpi3">Non</label>
                </div>
            </div>
        </div>

        <div class="form-group">
            <label class="form-label">Avez-vous d√©j√† √©t√© parmi les meilleurs agents / vendeurs ?</label>
            <div class="radio-group">
                <div class="radio-item">
                    <input type="radio" id="top1" name="top_performer" value="Oui, r√©guli√®rement">
                    <label for="top1">Oui, r√©guli√®rement</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="top2" name="top_performer" value="Oui, parfois">
                    <label for="top2">Oui, parfois</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="top3" name="top_performer" value="Non">
                    <label for="top3">Non</label>
                </div>
            </div>
        </div>

        <div class="form-group">
            <label for="achievement_story" class="form-label">D√©crivez un moment o√π vous avez d√©pass√© vos objectifs (optionnel)</label>
            <textarea id="achievement_story" name="achievement_story" class="form-textarea" placeholder="Racontez une r√©ussite dont vous √™tes fier(e)..."></textarea>
        </div>

        <div class="nav-buttons">
            <button type="button" class="btn btn-secondary" onclick="prevSection()">‚Üê Pr√©c√©dent</button>
            <button type="button" class="btn btn-primary" onclick="nextSection()">Suivant ‚Üí</button>
        </div>
    </div>

    <!-- Section 8: Mat√©riel & Conditions -->
    <div class="form-section" data-section="8">
        <div class="section-header">
            <div class="section-number">Section 8 / 13</div>
            <h2 class="section-title">Mat√©riel & Conditions de Travail</h2>
        </div>

        <div class="form-group">
            <label class="form-label required">Mat√©riel que vous utilisez actuellement (plusieurs r√©ponses possibles)</label>
            <div class="checkbox-group">
                <div class="checkbox-item">
                    <input type="checkbox" id="equip1" name="equipment_types" value="Ordinateur fixe">
                    <label for="equip1">Ordinateur fixe</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="equip2" name="equipment_types" value="Ordinateur portable">
                    <label for="equip2">Ordinateur portable</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="equip3" name="equipment_types" value="Aucun pour l'instant">
                    <label for="equip3">Aucun pour l'instant</label>
                </div>
            </div>
        </div>

        <div class="form-group">
            <label class="form-label required">Syst√®me d'exploitation principal</label>
            <div class="radio-group">
                <div class="radio-item">
                    <input type="radio" id="os1" name="operating_system" value="Windows" required>
                    <label for="os1">Windows</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="os2" name="operating_system" value="MacOS">
                    <label for="os2">MacOS</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="os3" name="operating_system" value="Linux">
                    <label for="os3">Linux</label>
                </div>
            </div>
        </div>

        <div class="form-group">
            <label class="form-label required">Disposez-vous d'un casque avec micro de bonne qualit√© ?</label>
            <div class="radio-group">
                <div class="radio-item">
                    <input type="radio" id="headset1" name="has_headset" value="Oui" required>
                    <label for="headset1">Oui</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="headset2" name="has_headset" value="Non, mais pr√™t(e) √† en acheter si n√©cessaire">
                    <label for="headset2">Non, mais pr√™t(e) √† en acheter si n√©cessaire</label>
                </div>
            </div>
        </div>

        <div class="form-group">
            <label class="form-label required">Type de connexion internet principale</label>
            <div class="radio-group">
                <div class="radio-item">
                    <input type="radio" id="inet1" name="internet_connection_type" value="Fibre" required>
                    <label for="inet1">Fibre</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="inet2" name="internet_connection_type" value="ADSL / VDSL">
                    <label for="inet2">ADSL / VDSL</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="inet3" name="internet_connection_type" value="4G">
                    <label for="inet3">4G</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="inet4" name="internet_connection_type" value="5G">
                    <label for="inet4">5G</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="inet4" name="internet_connection_type" value="5G">
                    <label for="inet4">Je ne sais pas</label>
                </div>
            </div>
        </div>

        <div class="form-group">
            <label class="form-label required">Test de vitesse internet</label>
            <div style="background: #f0f9ff; border: 1px solid #0ea5e9; border-radius: 8px; padding: 1rem; margin-bottom: 1rem;">
                <p style="color: #0c4a6e; margin-bottom: 0.75rem; font-size: 0.9rem;">
                    <strong>Lancer le test de connexion</strong>
                </p>
                <p style="color: #075985; font-size: 0.875rem; margin-bottom: 0.75rem;">
                    Merci de v√©rifier votre connexion internet. Cliquez sur ce lien pour lancer un test dans un nouvel onglet, puis indiquez les r√©sultats ci-dessous.
                </p>
                <a href="https://www.speedtest.net/" target="_blank" rel="noopener noreferrer" style="display: inline-block; background: #0ea5e9; color: white; padding: 0.5rem 1.5rem; border-radius: 6px; text-decoration: none; font-weight: 600; font-size: 0.875rem;">
                    üåê Ouvrir Speedtest.net
                </a>
            </div>

            <div class="internet-speed-grid">
                <div>
                    <label for="download_speed" class="form-label required">Download (Mbps)</label>
                    <input type="number" id="download_speed" name="download_speed" class="form-input" placeholder="ex: 25" step="0.01" min="0" required>
                    <small style="color: #64748b; font-size: 0.875rem;">Vitesse de t√©l√©chargement</small>
                </div>
                <div>
                    <label for="upload_speed" class="form-label required">Upload (Mbps)</label>
                    <input type="number" id="upload_speed" name="upload_speed" class="form-input" placeholder="ex: 5" step="0.01" min="0" required>
                    <small style="color: #64748b; font-size: 0.875rem;">Vitesse d'envoi</small>
                </div>
            </div>
        </div>

        <div class="form-group">
            <label class="form-label required">Centre d‚Äôappels</label>
            <div class="radio-group">
                <div class="radio-item">
                    <input type="radio" id="workspace1" name="workspace_type" value="Pi√®ce d√©di√©e au calme" required>
                    <label for="workspace1">Pi√®ce d√©di√©e au calme</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="workspace2" name="workspace_type" value="Salon ou pi√®ce partag√©e">
                    <label for="workspace2">Salon ou pi√®ce partag√©e</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="workspace3" name="workspace_type" value="Espaces publics (coworking, caf√©, etc.)">
                    <label for="workspace3">Espaces publics (coworking, caf√©, etc.)</label>
                </div>
            </div>
        </div>

        <div class="form-group">
            <label class="form-label required">√ätes-vous d'accord pour travailler avec (plusieurs r√©ponses possibles) :</label>
            <div class="checkbox-group">
                <div class="checkbox-item">
                    <input type="checkbox" id="agree1" name="work_agreements" value="Scripts d'appels fournis">
                    <label for="agree1">Scripts d'appels fournis</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="agree2" name="work_agreements" value="Outils de suivi du temps de travail">
                    <label for="agree2">Outils de suivi du temps de travail</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="agree3" name="work_agreements" value="Enregistrement d'appels pour la qualit√©">
                    <label for="agree3">Enregistrement d'appels pour la qualit√©</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="agree4" name="work_agreements" value="Reporting r√©gulier">
                    <label for="agree4">Reporting r√©gulier</label>
                </div>
            </div>
        </div>

        <div class="nav-buttons">
            <button type="button" class="btn btn-secondary" onclick="prevSection()">‚Üê Pr√©c√©dent</button>
            <button type="button" class="btn btn-primary" onclick="nextSection()">Suivant ‚Üí</button>
        </div>
    </div>

    <!-- Section 9: R√©mun√©ration -->
    <div class="form-section" data-section="9">
        <div class="section-header">
            <div class="section-number">Section 9 / 13</div>
            <h2 class="section-title">R√©mun√©ration (en DT)</h2>
        </div>

        <div class="form-group">
            <label class="form-label required">Modes de r√©mun√©ration que vous acceptez (plusieurs r√©ponses possibles)</label>
            <div class="checkbox-group">
                <div class="checkbox-item">
                    <input type="checkbox" id="pay1" name="payment_modes_accepted" value="Salaire fixe">
                    <label for="pay1">Salaire fixe</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="pay2" name="payment_modes_accepted" value="Fixe + primes sur r√©sultats">
                    <label for="pay2">Fixe + primes sur r√©sultats</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="pay3" name="payment_modes_accepted" value="R√©mun√©ration uniquement √† la performance">
                    <label for="pay3">R√©mun√©ration uniquement √† la performance</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="pay4" name="payment_modes_accepted" value="Facturation en freelance (au jour / au projet)">
                    <label for="pay4">Facturation en freelance (au jour / au projet)</label>
                </div>
            </div>
        </div>

        <div class="form-group">
            <label for="preferred_payment_mode" class="form-label required">Mode de r√©mun√©ration pr√©f√©r√©</label>
            <select id="preferred_payment_mode" name="preferred_payment_mode" class="form-select" required>
                <option value="">S√©lectionnez une option</option>
                <option value="Salaire fixe">Salaire fixe</option>
                <option value="Fixe + primes sur r√©sultats">Fixe + primes sur r√©sultats</option>
                <option value="R√©mun√©ration uniquement √† la performance">R√©mun√©ration uniquement √† la performance</option>
                <option value="Facturation en freelance (au jour / au projet)">Facturation en freelance (au jour / au projet)</option>
            </select>
        </div>

        <div class="form-group">
            <label for="salary_expectations" class="form-label required">Pr√©tentions salariales (en DT)</label>
            <input type="text" id="salary_expectations" name="salary_expectations" class="form-input" placeholder="Ex: 1500 DT " required>
        </div>

        <div class="form-group">
            <label class="form-label required">Accepteriez-vous une partie variable li√©e √† vos performances ?</label>
            <div class="radio-group">
                <div class="radio-item">
                    <input type="radio" id="var1" name="accept_variable_compensation" value="Oui" required>
                    <label for="var1">Oui</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="var2" name="accept_variable_compensation" value="Non">
                    <label for="var2">Non</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="var3" name="accept_variable_compensation" value="√Ä discuter">
                    <label for="var3">√Ä discuter</label>
                </div>
            </div>
        </div>

        <div class="nav-buttons">
            <button type="button" class="btn btn-secondary" onclick="prevSection()">‚Üê Pr√©c√©dent</button>
            <button type="button" class="btn btn-primary" onclick="nextSection()">Suivant ‚Üí</button>
        </div>
    </div>

    <!-- Section 10: Mindset & Soft Skills -->
    <div class="form-section" data-section="10">
        <div class="section-header">
            <div class="section-number">Section 10 / 13</div>
            <h2 class="section-title">Mindset & Soft Skills</h2>
        </div>

        <div class="form-group">
            <label for="difficult_client_response" class="form-label required">D√©crivez comment vous r√©agissez face √† un client difficile ou m√©content</label>
            <textarea id="difficult_client_response" name="difficult_client_response" class="form-textarea" placeholder="Expliquez votre approche face √† une situation difficile..." required></textarea>
        </div>

        <div class="form-group">
            <label class="form-label required">Dans quel type de cadre pr√©f√©rez-vous travailler ?</label>
            <div class="radio-group">
                <div class="radio-item">
                    <input type="radio" id="frame1" name="preferred_work_environment" value="Un cadre tr√®s structur√© (scripts, proc√©dures, r√®gles claires)" required>
                    <label for="frame1">Un cadre tr√®s structur√© (scripts, proc√©dures, r√®gles claires)</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="frame2" name="preferred_work_environment" value="Un cadre plus libre avec autonomie">
                    <label for="frame2">Un cadre plus libre avec autonomie</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="frame3" name="preferred_work_environment" value="Un √©quilibre entre les deux">
                    <label for="frame3">Un √©quilibre entre les deux</label>
                </div>
            </div>
        </div>

        <div class="form-group">
            <label for="three_qualities" class="form-label required">Citez 3 qualit√©s qui font de vous un(e) bon(ne) agent(e) de call center</label>
            <textarea id="three_qualities" name="three_qualities" class="form-textarea" placeholder="Ex: Patience, √©coute active, r√©solution de probl√®mes..." required></textarea>
        </div>

        <div class="form-group">
            <label for="three_improvements" class="form-label required">Citez 3 points sur lesquels vous aimeriez vous am√©liorer</label>
            <textarea id="three_improvements" name="three_improvements" class="form-textarea" placeholder="Soyez honn√™te, cela montre votre capacit√© d'introspection..." required></textarea>
        </div>

        <div class="form-group">
            <label class="form-label required">Avez-vous d√©j√† coach√© ou form√© un(e) coll√®gue (m√™me de mani√®re informelle) ?</label>
            <div class="radio-group">
                <div class="radio-item">
                    <input type="radio" id="coach1" name="has_coached_colleague" value="Oui" required>
                    <label for="coach1">Oui</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="coach2" name="has_coached_colleague" value="Non">
                    <label for="coach2">Non</label>
                </div>
            </div>
        </div>

        <div class="nav-buttons">
            <button type="button" class="btn btn-secondary" onclick="prevSection()">‚Üê Pr√©c√©dent</button>
            <button type="button" class="btn btn-primary" onclick="nextSection()">Suivant ‚Üí</button>
        </div>
    </div>

    <!-- Section 11: Supervision (Optional) -->
    <div class="form-section" data-section="11">
        <div class="section-header">
            <div class="section-number">Section 11 / 13</div>
            <h2 class="section-title">Exp√©rience de Supervision (Optionnel)</h2>
        </div>

        <div class="form-group">
            <label class="form-label">Avez-vous d√©j√† supervis√© ou manag√© une √©quipe ?</label>
            <div class="radio-group">
                <div class="radio-item">
                    <input type="radio" id="super1" name="supervisor_experience" value="Oui">
                    <label for="super1">Oui</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="super2" name="supervisor_experience" value="Non">
                    <label for="super2">Non</label>
                </div>
            </div>
        </div>

        <div class="form-group" id="supervision_details" style="display: none;">
            <label for="team_size_managed" class="form-label">Taille de l'√©quipe g√©r√©e</label>
            <input type="text" id="team_size_managed" name="team_size_managed" class="form-input" placeholder="Ex: 5-10 agents">

            <label for="management_style" class="form-label" style="margin-top: 1rem;">D√©crivez votre style de management</label>
            <textarea id="management_style" name="management_style" class="form-textarea" placeholder="Comment managez-vous votre √©quipe ?"></textarea>
        </div>

        <div class="nav-buttons">
            <button type="button" class="btn btn-secondary" onclick="prevSection()">‚Üê Pr√©c√©dent</button>
            <button type="button" class="btn btn-primary" onclick="nextSection()">Suivant ‚Üí</button>
        </div>
    </div>

    <!-- Section 12: Audio Recording -->
    <div class="form-section" data-section="12">
        <div class="section-header">
            <div class="section-number">Section 12 / 13</div>
            <h2 class="section-title">Enregistrement Vocal</h2>
        </div>

        <div class="form-group">
            <div id="audioRecorder">
                <h3 style="color: #2563eb; margin-bottom: 1rem;">Instructions</h3>
                <p style="color: #475569; margin-bottom: 1.5rem;">
                    Enregistrez-vous en r√©pondant √† la question suivante (dur√©e recommand√©e : 1-2 minutes) :<br><br>
                    <strong>"Pourquoi souhaitez-vous travailler dans un call center et qu'est-ce qui vous motive au quotidien ?"</strong>
                </p>

                <h4 style="color: #1e293b; margin-bottom: 1rem;">Enregistrer directement</h4>
                <button type="button" class="record-btn" id="recordBtn" onclick="toggleRecording()">
                    üé§ D√©marrer l'enregistrement
                </button>
                <div id="recordingStatus" style="color: #64748b; margin-top: 1rem;"></div>
                <div id="audioPlaybackContainer" style="margin-top: 1rem; display: none;">
                    <!-- Audio player will be inserted here -->
                </div>

                <p style="margin: 2rem 0; color: #94a3b8;">ou</p>

                <h4 style="color: #1e293b; margin-bottom: 1rem;">Uploader un fichier audio</h4>
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <input type="file" id="audio_recording" name="audio_recording" class="form-input" accept=".mp3,.wav,.webm,.ogg,.m4a" onchange="handleFileUpload(this)" style="flex: 1;">
                    <button type="button" id="clearUploadBtn" onclick="clearUploadedFile()" style="display: none; background: #ef4444; color: white; padding: 0.5rem 1rem; border: none; border-radius: 4px; cursor: pointer; white-space: nowrap;">
                        üóëÔ∏è Supprimer
                    </button>
                </div>
                <small style="color: #64748b; font-size: 0.875rem;">Formats accept√©s : MP3, WAV, WebM, OGG, M4A (max 10 MB)</small>
                <div id="uploadedFileName" style="color: #10b981; font-size: 0.875rem; margin-top: 0.5rem; display: none;"></div>

                <div class="alert alert-error" style="margin-top: 1.5rem; background: #fef2f2; border: 2px solid #ef4444; padding: 1rem; border-radius: 8px;">
                    <strong style="color: #991b1b; font-size: 1rem;">‚ö†Ô∏è OBLIGATOIRE</strong>
                    <p style="color: #7f1d1d; margin-top: 0.5rem; margin-bottom: 0;">
                        L'enregistrement vocal est <strong>obligatoire</strong> pour valider votre candidature. Vous devez soit enregistrer votre r√©ponse directement, soit uploader un fichier audio. Assurez-vous d'√™tre dans un environnement calme pour un enregistrement de qualit√©.
                    </p>
                </div>
            </div>
        </div>

        <div class="nav-buttons">
            <button type="button" class="btn btn-secondary" onclick="prevSection()">‚Üê Pr√©c√©dent</button>
            <button type="button" class="btn btn-primary" onclick="nextSection()">Suivant ‚Üí</button>
        </div>
    </div>

    <!-- Section 13: WhatsApp Interview -->
    <div class="form-section" data-section="13">
        <div class="section-header">
            <div class="section-number">Section 13 / 13</div>
            <h2 class="section-title">Entretien WhatsApp</h2>
        </div>

        <p style="color: #475569; margin-bottom: 1.5rem;">
            Prochaine √©tape : Nous vous contacterons sur WhatsApp pour un court entretien de validation.
            Assurez-vous que votre num√©ro WhatsApp est actif et que vous pouvez recevoir des messages.
        </p>

        <div class="form-group">
            <label for="whatsapp_number" class="form-label required">Num√©ro WhatsApp</label>
            <input type="tel" id="whatsapp_number" name="whatsapp_number" class="form-input" placeholder="+216 XX XXX XXX" required>
            <small id="whatsapp_error" style="color: #ef4444; font-size: 0.875rem; display: none; margin-top: 0.25rem;">Veuillez entrer un num√©ro WhatsApp valide.</small>
            <small style="color: #64748b; font-size: 0.875rem;">
                Format international recommand√© (ex: +216 pour la Tunisie)<br>
                Si votre num√©ro WhatsApp est diff√©rent de votre num√©ro de t√©l√©phone principal, veuillez indiquer celui que vous utilisez sur WhatsApp.
            </small>
        </div>

        <div class="form-group">
            <label for="interview_availability" class="form-label required">Vos disponibilit√©s pour un entretien WhatsApp</label>
            <textarea id="interview_availability" name="interview_availability" class="form-textarea" placeholder="Ex: Du lundi au vendredi de 9h √† 18h, ou le samedi matin..." required></textarea>
            <small style="color: #64748b; font-size: 0.875rem;">
                Indiquez vos cr√©neaux de disponibilit√© pour que nous puissions vous contacter au meilleur moment
            </small>
        </div>

        <div class="final-checklist">
            <h3 style="color: #15803d; margin-bottom: 1rem;">üéâ Derni√®re √©tape !</h3>
            <p style="color: #166534; margin-bottom: 1rem;">
                Vous √™tes sur le point de soumettre votre candidature. Avant de valider, assurez-vous que :
            </p>
            <div class="checklist-item">
                ‚úì Toutes les informations sont correctes et compl√®tes
            </div>
            <div class="checklist-item">
                ‚úì Votre CV a √©t√© upload√©
            </div>
            <div class="checklist-item">
                ‚úì Votre enregistrement vocal est de bonne qualit√©
            </div>
            <div class="checklist-item">
                ‚úì Votre num√©ro WhatsApp est actif et correct
            </div>
            <p style="color: #166534; margin-top: 1rem; font-size: 0.875rem;">
                Une fois valid√©e, notre √©quipe examinera votre dossier et vous contactera dans les plus brefs d√©lais.
            </p>
            <p style="color: #166534; margin-top: 1rem; font-size: 0.875rem; background: white; padding: 0.75rem; border-radius: 6px;">
                <strong>Note importante :</strong> L'entretien WhatsApp dure g√©n√©ralement entre 10 et 15 minutes.
                Il s'agit d'un √©change informel pour mieux vous conna√Ætre et r√©pondre √† vos questions.
            </p>
        </div>

        <div class="nav-buttons">
            <button type="button" class="btn btn-secondary" onclick="prevSection()">‚Üê Pr√©c√©dent</button>
            <button type="submit" class="btn btn-primary" style="font-size: 1.125rem; padding: 1rem 2rem;">
                ‚úÖ Soumettre ma candidature
            </button>
        </div>
    </div>
</form>

<script>
let currentSection = 1;
const totalSections = 13;
let mediaRecorder = null;
let audioChunks = [];

function updateProgress() {
    const progress = (currentSection / totalSections) * 100;
    document.getElementById('progressBar').style.width = progress + '%';
}

function showSection(sectionNumber) {
    document.querySelectorAll('.form-section').forEach(section => {
        section.classList.remove('active');
    });
    document.querySelector(`[data-section="${sectionNumber}"]`).classList.add('active');
    window.scrollTo(0, 0);
}

function validateSection(sectionNumber) {
    const section = document.querySelector(`[data-section="${sectionNumber}"]`);
    const requiredInputs = section.querySelectorAll('input[required], select[required], textarea[required]');
    const errors = [];

    // Section 1 specific validations
    if (sectionNumber === 1) {
        // Validate date of birth
        if (!validateDateOfBirth()) {
            errors.push('Vous devez avoir au moins 18 ans pour postuler');
        }

        // Validate email
        if (!validateEmail()) {
            errors.push('Veuillez entrer une adresse e-mail valide');
        }

        // Validate phone number
        if (!validatePhoneNumber()) {
            errors.push('Veuillez entrer un num√©ro de t√©l√©phone valide');
        }

        // Validate "other country" field if "Autre" is selected
        const countrySelect = document.getElementById('country');
        const otherCountryInput = document.getElementById('other_country');
        if (countrySelect && countrySelect.value === 'Autre') {
            if (!otherCountryInput.value.trim()) {
                errors.push('Veuillez pr√©ciser le nom du pays');
            }
        }
    }

    // Section 2 specific validations
    if (sectionNumber === 2) {
        // Validate "other situation" field if "Autre" is selected
        const currentSituation = document.querySelector('input[name="current_situation"]:checked');
        const otherSituationInput = document.getElementById('other_situation');
        if (currentSituation && currentSituation.value === 'Autre') {
            if (!otherSituationInput.value.trim()) {
                errors.push('Veuillez pr√©ciser votre situation actuelle');
            }
        }
    }

    // Section 13 specific validations
    if (sectionNumber === 13) {
        // Validate WhatsApp number
        if (!validateWhatsAppNumber()) {
            errors.push('Veuillez entrer un num√©ro WhatsApp valide');
        }
    }

    // Validate regular inputs
    requiredInputs.forEach(input => {
        if (input.type === 'radio') {
            const radioGroup = section.querySelectorAll(`input[name="${input.name}"]`);
            const isChecked = Array.from(radioGroup).some(radio => radio.checked);
            if (!isChecked) {
                errors.push(`Veuillez s√©lectionner une option pour "${input.closest('.form-group')?.querySelector('.form-label')?.textContent || 'ce champ'}"`);
            }
        } else if (input.type === 'checkbox') {
            // Skip individual checkbox validation - handled separately below
        } else if (!input.value.trim()) {
            const label = input.closest('.form-group')?.querySelector('.form-label')?.textContent || 'Ce champ';
            errors.push(`${label} est requis`);
        }
    });

    // Validate checkbox groups (at least one must be checked)
    const checkboxGroups = {};
    section.querySelectorAll('.checkbox-group').forEach(group => {
        const groupLabel = group.previousElementSibling?.textContent || 'Cette section';
        const checkboxes = group.querySelectorAll('input[type="checkbox"]');
        const hasChecked = Array.from(checkboxes).some(cb => cb.checked);

        if (checkboxes.length > 0) {
            const firstCheckboxName = checkboxes[0].name;
            if (!checkboxGroups[firstCheckboxName]) {
                checkboxGroups[firstCheckboxName] = { hasChecked, label: groupLabel };
            }
        }
    });

    // Check if any checkbox group is required and empty
    for (const [name, data] of Object.entries(checkboxGroups)) {
        if (!data.hasChecked && data.label.includes('*')) {
            errors.push(`Veuillez s√©lectionner au moins une option pour "${data.label.replace('*', '').trim()}"`);
        }
    }

    // Section-specific validations
    if (sectionNumber === 2) {
        // Contract types
        const contractTypes = section.querySelectorAll('input[name="contract_types"]:checked');
        if (contractTypes.length === 0) {
            errors.push('Veuillez s√©lectionner au moins un type de contrat');
        }

        // Time slots
        const timeSlots = section.querySelectorAll('input[name="time_slots"]:checked');
        if (timeSlots.length === 0) {
            errors.push('Veuillez s√©lectionner au moins une tranche horaire');
        }

        // Week days
        const weekDays = section.querySelectorAll('input[name="week_days"]:checked');
        if (weekDays.length === 0) {
            errors.push('Veuillez s√©lectionner au moins un jour de disponibilit√©');
        }
    }

    if (sectionNumber === 3) {
        // Languages
        const languages = section.querySelectorAll('input[name="languages"]:checked');
        if (languages.length === 0) {
            errors.push('Veuillez s√©lectionner au moins une langue');
        }

        // Validate language details for each selected language
        languages.forEach(langCheckbox => {
            const language = langCheckbox.value;
            const globalLevel = document.querySelector(`select[name="lang_global_${language}"]`);
            const listeningLevel = document.querySelector(`select[name="lang_listening_${language}"]`);
            const speakingLevel = document.querySelector(`select[name="lang_speaking_${language}"]`);
            const writingLevel = document.querySelector(`select[name="lang_writing_${language}"]`);

            if (!globalLevel || !globalLevel.value) {
                errors.push(`Veuillez s√©lectionner le niveau global pour ${language}`);
            }
            if (!listeningLevel || !listeningLevel.value) {
                errors.push(`Veuillez s√©lectionner le niveau de compr√©hension orale pour ${language}`);
            }
            if (!speakingLevel || !speakingLevel.value) {
                errors.push(`Veuillez s√©lectionner le niveau d'expression orale pour ${language}`);
            }
            if (!writingLevel || !writingLevel.value) {
                errors.push(`Veuillez s√©lectionner le niveau d'expression √©crite pour ${language}`);
            }
        });
    }

    if (sectionNumber === 4) {
        // Target positions
        const positions = section.querySelectorAll('input[name="target_positions"]:checked');
        if (positions.length === 0) {
            errors.push('Veuillez s√©lectionner au moins un poste vis√©');
        }
    }

    if (sectionNumber === 8) {
        // Equipment
        const equipment = section.querySelectorAll('input[name="equipment_types"]:checked');
        if (equipment.length === 0) {
            errors.push('Veuillez s√©lectionner au moins un type de mat√©riel');
        }

        // Work agreements
        const agreements = section.querySelectorAll('input[name="work_agreements"]:checked');
        if (agreements.length === 0) {
            errors.push('Veuillez accepter au moins une condition de travail');
        }
    }

    if (sectionNumber === 9) {
        // Payment modes
        const paymentModes = section.querySelectorAll('input[name="payment_modes_accepted"]:checked');
        if (paymentModes.length === 0) {
            errors.push('Veuillez s√©lectionner au moins un mode de r√©mun√©ration accept√©');
        }
    }

    if (sectionNumber === 12) {
        // Audio recording validation
        const audioInput = document.getElementById('audio_recording');
        if (!audioInput.files || audioInput.files.length === 0) {
            errors.push('‚ö†Ô∏è L\'enregistrement vocal est obligatoire. Veuillez enregistrer votre audio ou uploader un fichier audio.');
        }
    }

    // Display errors
    if (errors.length > 0) {
        alert('Veuillez corriger les erreurs suivantes :\n\n' + errors.join('\n'));
        return false;
    }

    return true;
}

function nextSection() {
    if (validateSection(currentSection)) {
        if (currentSection < totalSections) {
            currentSection++;
            showSection(currentSection);
            updateProgress();
        }
    }
}

function prevSection() {
    if (currentSection > 1) {
        currentSection--;
        showSection(currentSection);
        updateProgress();
    }
}

// Country code mapping
const countryPhoneCodes = {
    'Tunisie': '+216',
    'France': '+33',
    'Maroc': '+212',
    'Alg√©rie': '+213',
    'Autre': '+00'
};

// Date of birth validation (18+ years)
function validateDateOfBirth() {
    const dobInput = document.getElementById('date_of_birth');
    const dobError = document.getElementById('dob_error');

    if (!dobInput.value) {
        dobError.style.display = 'none';
        return true;
    }

    const dob = new Date(dobInput.value);
    const today = new Date();
    let age = today.getFullYear() - dob.getFullYear();
    const monthDiff = today.getMonth() - dob.getMonth();

    if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < dob.getDate())) {
        age--;
    }

    if (age < 18) {
        dobError.style.display = 'block';
        dobInput.setCustomValidity('Vous devez avoir au moins 18 ans pour postuler.');
        return false;
    } else {
        dobError.style.display = 'none';
        dobInput.setCustomValidity('');
        return true;
    }
}

// Email validation
function validateEmail() {
    const emailInput = document.getElementById('email');
    const emailError = document.getElementById('email_error');
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

    if (!emailInput.value) {
        emailError.style.display = 'none';
        return true;
    }

    if (!emailRegex.test(emailInput.value)) {
        emailError.style.display = 'block';
        emailInput.setCustomValidity('Veuillez entrer une adresse e-mail valide.');
        return false;
    } else {
        emailError.style.display = 'none';
        emailInput.setCustomValidity('');
        return true;
    }
}

// Phone number validation
function validatePhoneNumber() {
    const phoneInput = document.getElementById('phone');
    const phoneError = document.getElementById('phone_error');
    const phoneValue = phoneInput.value.trim();

    if (!phoneValue) {
        phoneError.style.display = 'none';
        return true;
    }

    // Check if it starts with + and contains only digits, spaces, and dashes after the +
    const phoneRegex = /^\+\d{1,4}[\s\d\-]{6,}$/;

    if (!phoneRegex.test(phoneValue.replace(/\s/g, ''))) {
        phoneError.style.display = 'block';
        phoneInput.setCustomValidity('Veuillez entrer un num√©ro de t√©l√©phone valide avec l\'indicatif pays (ex: +216 12345678).');
        return false;
    } else {
        phoneError.style.display = 'none';
        phoneInput.setCustomValidity('');
        return true;
    }
}

// Update phone prefix based on country selection
function updatePhonePrefix() {
    const countrySelect = document.getElementById('country');
    const phoneInput = document.getElementById('phone');
    const selectedCountry = countrySelect.value;

    if (selectedCountry && countryPhoneCodes[selectedCountry]) {
        const prefix = countryPhoneCodes[selectedCountry];
        const currentValue = phoneInput.value.trim();

        // Only update if field is empty or starts with a different prefix
        if (!currentValue || currentValue.startsWith('+')) {
            phoneInput.value = prefix + '';
        } else if (!currentValue.startsWith(prefix)) {
            phoneInput.value = prefix + '' + currentValue.replace(/^\+\d+\s*/, '');
        }

        // Update placeholder
        phoneInput.placeholder = prefix + 'XX XXX XXX';
    }
}

// WhatsApp number validation
function validateWhatsAppNumber() {
    const whatsappInput = document.getElementById('whatsapp_number');
    const whatsappError = document.getElementById('whatsapp_error');
    const whatsappValue = whatsappInput.value.trim();

    if (!whatsappValue) {
        whatsappError.style.display = 'none';
        return true;
    }

    // Check if it starts with + and contains only digits, spaces, and dashes after the +
    const phoneRegex = /^\+\d{1,4}[\s\d\-]{6,}$/;

    if (!phoneRegex.test(whatsappValue.replace(/\s/g, ''))) {
        whatsappError.style.display = 'block';
        whatsappInput.setCustomValidity('Veuillez entrer un num√©ro WhatsApp valide avec l\'indicatif pays (ex: +216 12345678).');
        return false;
    } else {
        whatsappError.style.display = 'none';
        whatsappInput.setCustomValidity('');
        return true;
    }
}

// Language details management
function toggleLanguageDetails(language, isChecked) {
    const container = document.getElementById('languageDetailsContainer');
    const blockId = `lang_details_${language.replace(/\s+/g, '_')}`;
    const existingBlock = document.getElementById(blockId);

    if (isChecked && !existingBlock) {
        // Create language details block
        const detailsBlock = document.createElement('div');
        detailsBlock.id = blockId;
        detailsBlock.className = 'language-details-block';
        detailsBlock.innerHTML = `
            <h4>${language}</h4>

            <div class="form-group">
                <label class="form-label required">Niveau global</label>
                <select name="lang_global_${language}" class="form-select" required>
                    <option value="">S√©lectionnez votre niveau</option>
                    <option value="A1">A1 ‚Äì D√©butant</option>
                    <option value="A2">A2 ‚Äì √âl√©mentaire</option>
                    <option value="B1">B1 ‚Äì Interm√©diaire</option>
                    <option value="B2">B2 ‚Äì Interm√©diaire avanc√©</option>
                    <option value="C1">C1 ‚Äì Avanc√©</option>
                    <option value="C2">C2 ‚Äì Bilingue / Langue maternelle</option>
                </select>
            </div>

            <div class="language-detail-row">
                <div class="form-group">
                    <label class="form-label required">Compr√©hension orale</label>
                    <select name="lang_listening_${language}" class="form-select" required>
                        <option value="">S√©lectionnez</option>
                        <option value="faible">Faible</option>
                        <option value="moyen">Moyen</option>
                        <option value="bon">Bon</option>
                        <option value="excellent">Excellent</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label required">Expression orale</label>
                    <select name="lang_speaking_${language}" class="form-select" required>
                        <option value="">S√©lectionnez</option>
                        <option value="faible">Faible</option>
                        <option value="moyen">Moyen</option>
                        <option value="bon">Bon</option>
                        <option value="excellent">Excellent</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label required">Expression √©crite</label>
                    <select name="lang_writing_${language}" class="form-select" required>
                        <option value="">S√©lectionnez</option>
                        <option value="faible">Faible</option>
                        <option value="moyen">Moyen</option>
                        <option value="bon">Bon</option>
                        <option value="excellent">Excellent</option>
                    </select>
                </div>
            </div>
        `;
        container.appendChild(detailsBlock);
    } else if (!isChecked && existingBlock) {
        // Remove language details block
        existingBlock.remove();
    }
}

// Conditional field displays
document.addEventListener('DOMContentLoaded', function() {
    // Date of birth validation
    const dobInput = document.getElementById('date_of_birth');
    if (dobInput) {
        dobInput.addEventListener('change', validateDateOfBirth);
        dobInput.addEventListener('blur', validateDateOfBirth);
    }

    // Email validation
    const emailInput = document.getElementById('email');
    if (emailInput) {
        emailInput.addEventListener('input', validateEmail);
        emailInput.addEventListener('blur', validateEmail);
    }

    // Phone validation
    const phoneInput = document.getElementById('phone');
    if (phoneInput) {
        phoneInput.addEventListener('input', validatePhoneNumber);
        phoneInput.addEventListener('blur', validatePhoneNumber);
    }

    // WhatsApp validation
    const whatsappInput = document.getElementById('whatsapp_number');
    if (whatsappInput) {
        whatsappInput.addEventListener('input', validateWhatsAppNumber);
        whatsappInput.addEventListener('blur', validateWhatsAppNumber);
    }

    // Country selection handler
    const countrySelect = document.getElementById('country');
    const otherCountryGroup = document.getElementById('other_country_group');
    const otherCountryInput = document.getElementById('other_country');

    if (countrySelect) {
        countrySelect.addEventListener('change', function() {
            // Show/hide custom country input
            if (this.value === 'Autre') {
                otherCountryGroup.style.display = 'block';
                otherCountryInput.required = true;
            } else {
                otherCountryGroup.style.display = 'none';
                otherCountryInput.required = false;
                otherCountryInput.value = '';
            }

            // Update phone prefix
            updatePhonePrefix();
        });
    }

    // Current situation handler
    document.querySelectorAll('input[name="current_situation"]').forEach(radio => {
        radio.addEventListener('change', function() {
            const otherSituationGroup = document.getElementById('other_situation_group');
            const otherSituationInput = document.getElementById('other_situation');

            if (this.value === 'Autre') {
                otherSituationGroup.style.display = 'block';
                otherSituationInput.required = true;
            } else {
                otherSituationGroup.style.display = 'none';
                otherSituationInput.required = false;
                otherSituationInput.value = '';
            }
        });
    });

    // Availability details
    document.querySelectorAll('input[name="availability"]').forEach(radio => {
        radio.addEventListener('change', function() {
            const detailsGroup = document.getElementById('availability_details_group');
            detailsGroup.style.display = this.value === 'Plus tard' ? 'block' : 'none';
        });
    });

    // Full-time flexibility conditions
    document.querySelectorAll('input[name="full_time_flexibility"]').forEach(radio => {
        radio.addEventListener('change', function() {
            const conditionsGroup = document.getElementById('flexibility_conditions_group');
            conditionsGroup.style.display = this.value === 'Oui, mais sous conditions' ? 'block' : 'none';
        });
    });

    // Supervision details
    document.querySelectorAll('input[name="supervisor_experience"]').forEach(radio => {
        radio.addEventListener('change', function() {
            const detailsGroup = document.getElementById('supervision_details');
            detailsGroup.style.display = this.value === 'Oui' ? 'block' : 'none';
        });
    });
});

// Experience management
let experienceCount = 0;

function addExperience() {
    experienceCount++;
    const container = document.getElementById('experiencesContainer');
    const expDiv = document.createElement('div');
    expDiv.className = 'experience-item';
    expDiv.innerHTML = `
        <h4 style="color: #2563eb; margin-bottom: 1rem;">Exp√©rience #${experienceCount}</h4>
        <div class="form-group">
            <label class="form-label">Poste occup√©</label>
            <input type="text" name="exp_position_${experienceCount}" class="form-input" placeholder="Ex: Agent call center">
        </div>
        <div class="form-group">
            <label class="form-label">Entreprise</label>
            <input type="text" name="exp_company_${experienceCount}" class="form-input" placeholder="Nom de l'entreprise">
        </div>
        <div class="form-group">
            <label class="form-label">Date de d√©but</label>
            <input type="date" name="exp_start_date_${experienceCount}" class="form-input" id="exp_start_date_${experienceCount}">
        </div>
        <div class="form-group">
            <label class="form-label">Date de fin</label>
            <input type="date" name="exp_end_date_${experienceCount}" class="form-input" id="exp_end_date_${experienceCount}">
            <div style="margin-top: 0.5rem;">
                <input type="checkbox" id="exp_current_${experienceCount}" name="exp_current_${experienceCount}" onchange="toggleEndDate(${experienceCount})">
                <label for="exp_current_${experienceCount}" style="display: inline; font-weight: normal; margin-left: 0.25rem;">Poste actuel</label>
            </div>
            <small id="exp_date_error_${experienceCount}" style="color: #ef4444; font-size: 0.875rem; display: none; margin-top: 0.25rem;">La date de fin doit √™tre post√©rieure √† la date de d√©but.</small>
        </div>
        <div class="form-group">
            <label class="form-label">Description</label>
            <textarea name="exp_description_${experienceCount}" class="form-textarea" placeholder="D√©crivez vos missions et r√©alisations..."></textarea>
        </div>
        <button type="button" class="remove-btn" onclick="this.parentElement.remove()">üóëÔ∏è Supprimer</button>
    `;
    container.appendChild(expDiv);

    // Add event listeners for date validation
    const currentExpNum = experienceCount;
    const startDateInput = document.getElementById(`exp_start_date_${currentExpNum}`);
    const endDateInput = document.getElementById(`exp_end_date_${currentExpNum}`);

    if (startDateInput) {
        startDateInput.addEventListener('change', () => validateExperienceDates(currentExpNum));
        startDateInput.addEventListener('blur', () => validateExperienceDates(currentExpNum));
    }

    if (endDateInput) {
        endDateInput.addEventListener('change', () => validateExperienceDates(currentExpNum));
        endDateInput.addEventListener('blur', () => validateExperienceDates(currentExpNum));
    }
}

// Audio recording
function toggleRecording() {
    const btn = document.getElementById('recordBtn');
    const status = document.getElementById('recordingStatus');

    if (!mediaRecorder || mediaRecorder.state === 'inactive') {
        navigator.mediaDevices.getUserMedia({ audio: true })
            .then(stream => {
                mediaRecorder = new MediaRecorder(stream);
                audioChunks = [];

                mediaRecorder.addEventListener('dataavailable', event => {
                    audioChunks.push(event.data);
                });

                mediaRecorder.addEventListener('stop', () => {
                    const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
                    const audioUrl = URL.createObjectURL(audioBlob);

                    // Create audio player with delete button
                    const playbackContainer = document.getElementById('audioPlaybackContainer');
                    playbackContainer.innerHTML = `
                        <div style="background: #f0fdf4; border: 1px solid #86efac; border-radius: 8px; padding: 1rem;">
                            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.5rem;">
                                <span style="color: #15803d; font-weight: 600;">‚úÖ Enregistrement termin√©</span>
                                <button type="button" onclick="deleteRecording()" style="background: #ef4444; color: white; padding: 0.5rem 1rem; border: none; border-radius: 4px; cursor: pointer; font-size: 0.875rem;">
                                    üóëÔ∏è Supprimer et r√©enregistrer
                                </button>
                            </div>
                            <audio controls style="width: 100%; margin-top: 0.5rem;">
                                <source src="${audioUrl}" type="audio/webm">
                            </audio>
                        </div>
                    `;
                    playbackContainer.style.display = 'block';

                    // Convert to File and set to input
                    const file = new File([audioBlob], 'recording.webm', { type: 'audio/webm' });
                    const dataTransfer = new DataTransfer();
                    dataTransfer.items.add(file);
                    document.getElementById('audio_recording').files = dataTransfer.files;

                    status.textContent = '';
                });

                mediaRecorder.start();
                btn.textContent = '‚èπÔ∏è Arr√™ter l\'enregistrement';
                btn.classList.add('recording');
                status.textContent = 'üî¥ Enregistrement en cours...';
                status.style.color = '#ef4444';
            })
            .catch(err => {
                status.textContent = '‚ùå Erreur: Microphone non accessible';
                status.style.color = '#ef4444';
            });
    } else {
        mediaRecorder.stop();
        mediaRecorder.stream.getTracks().forEach(track => track.stop());
        btn.textContent = 'üé§ D√©marrer l\'enregistrement';
        btn.classList.remove('recording');
    }
}

// Delete recording and allow re-recording
function deleteRecording() {
    // Clear the audio input
    const audioInput = document.getElementById('audio_recording');
    audioInput.value = '';

    // Hide the playback container
    const playbackContainer = document.getElementById('audioPlaybackContainer');
    playbackContainer.style.display = 'none';
    playbackContainer.innerHTML = '';

    // Reset status
    const status = document.getElementById('recordingStatus');
    status.textContent = '';

    // Reset button
    const btn = document.getElementById('recordBtn');
    btn.textContent = 'üé§ D√©marrer l\'enregistrement';
    btn.classList.remove('recording');

    // Reset mediaRecorder
    if (mediaRecorder && mediaRecorder.state !== 'inactive') {
        mediaRecorder.stop();
        mediaRecorder.stream.getTracks().forEach(track => track.stop());
    }
    mediaRecorder = null;
    audioChunks = [];
}

// Handle file upload
function handleFileUpload(input) {
    const clearBtn = document.getElementById('clearUploadBtn');
    const fileNameDisplay = document.getElementById('uploadedFileName');

    if (input.files && input.files[0]) {
        clearBtn.style.display = 'inline-block';
        fileNameDisplay.textContent = `üìé Fichier s√©lectionn√©: ${input.files[0].name}`;
        fileNameDisplay.style.display = 'block';

        // Clear any recorded audio
        const playbackContainer = document.getElementById('audioPlaybackContainer');
        playbackContainer.style.display = 'none';
        playbackContainer.innerHTML = '';
    } else {
        clearBtn.style.display = 'none';
        fileNameDisplay.style.display = 'none';
    }
}

// Clear uploaded file
function clearUploadedFile() {
    const audioInput = document.getElementById('audio_recording');
    audioInput.value = '';

    const clearBtn = document.getElementById('clearUploadBtn');
    clearBtn.style.display = 'none';

    const fileNameDisplay = document.getElementById('uploadedFileName');
    fileNameDisplay.style.display = 'none';
    fileNameDisplay.textContent = '';
}

// Toggle end date field for current position
function toggleEndDate(expNum) {
    const currentCheckbox = document.getElementById(`exp_current_${expNum}`);
    const endDateInput = document.getElementById(`exp_end_date_${expNum}`);

    if (currentCheckbox && currentCheckbox.checked) {
        endDateInput.disabled = true;
        endDateInput.value = '';
        endDateInput.style.backgroundColor = '#f1f5f9';
    } else {
        endDateInput.disabled = false;
        endDateInput.style.backgroundColor = '';
    }
}

// Validate experience dates
function validateExperienceDates(expNum) {
    const startDateInput = document.getElementById(`exp_start_date_${expNum}`);
    const endDateInput = document.getElementById(`exp_end_date_${expNum}`);
    const currentCheckbox = document.getElementById(`exp_current_${expNum}`);
    const errorElement = document.getElementById(`exp_date_error_${expNum}`);

    if (!startDateInput || !endDateInput || !errorElement) {
        return true;
    }

    // Skip validation if current position is checked
    if (currentCheckbox && currentCheckbox.checked) {
        errorElement.style.display = 'none';
        endDateInput.setCustomValidity('');
        return true;
    }

    const startDate = startDateInput.value;
    const endDate = endDateInput.value;

    // Skip if either date is empty
    if (!startDate || !endDate) {
        errorElement.style.display = 'none';
        endDateInput.setCustomValidity('');
        return true;
    }

    // Validate that end date is after start date
    if (new Date(endDate) <= new Date(startDate)) {
        errorElement.style.display = 'block';
        endDateInput.setCustomValidity('La date de fin doit √™tre post√©rieure √† la date de d√©but.');
        return false;
    } else {
        errorElement.style.display = 'none';
        endDateInput.setCustomValidity('');
        return true;
    }
}

// Form submission handler
document.getElementById('multiStepForm').addEventListener('submit', function(e) {
    // Validate all experience dates before submission
    let hasDateErrors = false;
    for (let i = 1; i <= experienceCount; i++) {
        if (!validateExperienceDates(i)) {
            hasDateErrors = true;
        }
    }

    if (hasDateErrors) {
        e.preventDefault();
        alert('Veuillez corriger les erreurs dans les dates d\'exp√©rience.');
        return false;
    }

    // Collect experiences into JSON
    const experiences = [];
    for (let i = 1; i <= experienceCount; i++) {
        const position = document.querySelector(`[name="exp_position_${i}"]`)?.value;
        const company = document.querySelector(`[name="exp_company_${i}"]`)?.value;
        const startDate = document.querySelector(`[name="exp_start_date_${i}"]`)?.value;
        const endDate = document.querySelector(`[name="exp_end_date_${i}"]`)?.value;
        const isCurrent = document.querySelector(`[name="exp_current_${i}"]`)?.checked;
        const description = document.querySelector(`[name="exp_description_${i}"]`)?.value;

        if (position || company) {
            experiences.push({
                position,
                company,
                start_date: startDate,
                end_date: isCurrent ? null : endDate,
                is_current: isCurrent || false,
                description
            });
        }
    }

    // Add hidden field for experiences
    if (experiences.length > 0) {
        const input = document.createElement('input');
        input.type = 'hidden';
        input.name = 'experiences_json';
        input.value = JSON.stringify(experiences);
        this.appendChild(input);
    }
});
</script>
{% endblock %}
